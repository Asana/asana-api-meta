---
!include ../includes.yaml
name: story
comment: |
  A _story_ represents an activity associated with an object in the Asana
  system. Stories are generated by the system whenever users take actions such
  as creating or assigning tasks, or moving tasks between projects. _Comments_
  are also a form of user-generated story.

  Stories are a form of history in the system, and as such they are read-only.
  Once generated, it is not possible to modify a story.
properties:

  - name: id
    <<: *PropType.Id
    comment: |
      Globally unique ID of the story.

  - name: created_at
    <<: *PropType.DateTime
    comment: |
      The time at which this story was created.

  - name: created_by
    <<: *PropType.User
    comment: |
      The user who created the story.

  - name: liked
    <<: *PropType.Bool
    comment: |
      True if the story is liked by the authorized user, false if not.
    notes:
      - |
        This property only exists for stories that provide likes.

  - name: likes
    <<: *PropType.UserArray
    access: Read-only
    comment: |
      Array of users who have liked this story.
    notes:
      - |
        This property only exists for stories that provide likes.

  - name: num_likes
    <<: *PropType.Count
    access: Read-only
    comment: |
      The number of users who have liked this story.
    notes:
      - |
        This property only exists for stories that provide likes.

  - name: text
    type: String
    example_values:
      - "'marked today'"
    access: Create-only
    comment: |
      Human-readable text for the story or comment. This will not include the
      name of the creator.
    notes:
      - |
        This is not guaranteed to be stable for a given type of story. For
        example, text for a reassignment may not always say &ldquo;assigned to â€¦&rdquo;.
        The API currently does not provide a structured way of inspecting the
        meaning of a story.

  - name: html_text
    <<: *PropType.HtmlText
    comment: |
      HTML formatted text for a comment. This will not include the name of the creator.
    notes:
      - |
        This field is only returned if explicitly requested using the `opt_fields`
        query parameter.

  - name: target
    <<: *PropType.Task
    comment: |
      The object this story is associated with. Currently may only be a task.

  - name: is_pinned
    <<: *PropType.Bool
    comment: |
      Whether the story is pinned on the target.
    notes:
      - This field is only present on comment and attachment stories.

  - name: is_edited
    <<: *PropType.Bool
    comment: |
      Whether the text of the story has been edited after creation.
    notes:
      - This field is only present on comment stories.

  - name: source
    <<: *PropType.StorySource
    comment: |
      The component of the Asana product the user used to trigger the story.

  - name: type
    <<: *PropType.StoryType
    comment: |
      The type of story this is.

action_classes:
  - name: Get stories on object
    url: get-all
  - name: Get a single story
    url: get-single
  - name: Commenting on an object
    url: post-comment
  - name: Update a story
    url: update

actions:

  # Create, Retrieve, Update, Delete

  - name: findByTask
    class: get-all
    method: GET
    path: "/tasks/%s/stories"
    collection: true
    params:
      - name: task
        <<: *Param.TaskId
        required: true
    comment: |
      Returns the compact records for all stories on the task.

  - name: findById
    class: get-single
    method: GET
    path: "/stories/%s"
    params:
      - name: story
        <<: *Param.StoryId
        required: true
    comment: |
      Returns the full record for a single story.

  - name: createOnTask
    class: post-comment
    <<: *Action.CommentOnTask

  - name: update
    class: update
    method: PUT
    path: "/stories/%s"
    params:
      - name: story
        <<: *Param.StoryId
        required: true
      - name: text
        type: String
        example_values:
          - "'This is a comment.'"
        comment: |
          The plain text with which to update the comment.
      - name: html_text
        type: String
        example_values:
          - "'Get whatever &lt;a href='https://app.asana.com/0/1123/1234'&gt;Sashimi&lt;/a&gt; has.'"
        comment: The rich text with which to update the comment.
      - name: is_pinned
        <<: *Param.Bool
        comment: Whether the story should be pinned on the resource.
    comment: |
      Updates the story and returns the full record for the updated story.
      Only comment stories can have their text updated, and only comment stories and
      attachment stories can be pinned. Only one of `text` and `html_text` can be specified.
